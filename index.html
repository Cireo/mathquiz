<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Quest! 🦊✨</title>
    <link rel="stylesheet" href="src/css/main.css">
    <link rel="stylesheet" href="src/css/animations.css">
</head>
<body>
    <!-- Name Input Screen -->
    <div id="name-input-screen" class="screen active">
        <div class="container">
            <div class="welcome-content">
                <h1 class="title">🌟 Math Quest! 🌟</h1>
                <div class="mascot">🦊</div>
                <div class="name-input-section">
                    <h2>Welcome, young mathematician!</h2>
                    <p>What's your name?</p>
                    <div class="name-input-container">
                        <input type="text" id="player-name-input" class="name-input" placeholder="Enter your name..." maxlength="20" autofocus>
                        <button id="start-adventure-btn" class="action-button">Start My Adventure! 🚀</button>
                    </div>
                    <p class="name-hint">Your name will appear throughout your math adventure!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen">
        <div class="container">
            <h1 class="title">🌟 <span id="player-name-title">Math Quest</span>! 🌟</h1>
            <div class="mascot">🦊</div>
            <p class="subtitle">Let's practice math together!</p>
            
            <div class="difficulty-selection">
                <h3>Choose your level:</h3>
                <button class="difficulty-btn" data-level="beginner">
                    🌱 Beginner
                    <small>Single digits & easy times tables</small>
                </button>
                <button class="difficulty-btn" data-level="intermediate">
                    🌿 Intermediate  
                    <small>Two digits & more times tables</small>
                </button>
                <button class="difficulty-btn" data-level="advanced">
                    🌳 Advanced
                    <small>Mixed operations & division</small>
                </button>
            </div>
            
            <div class="menu-actions">
                <button id="lessons-btn" class="menu-btn">
                    📚 Interactive Lessons
                    <small>Learn new strategies</small>
                </button>
                <button id="characters-btn" class="menu-btn">
                    🦊 Choose Character
                    <small>Unlock new companions</small>
                </button>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <div class="container">
            <!-- Header with stats -->
            <div class="game-header">
                <div class="stats-group">
                    <div class="stat-item">
                        <span class="label">Score:</span>
                        <span id="score" class="value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Streak:</span>
                        <span id="streak" class="value">0</span>
                        <span id="streak-fire" class="streak-indicator">🔥</span>
                    </div>
                    <div class="stat-item">
                        <span class="label">Level:</span>
                        <span id="level" class="value">1</span>
                    </div>
                </div>
                <button id="exit-game-btn" class="exit-button" title="Exit to Main Menu">✕</button>
            </div>

            <!-- Progress bar -->
            <div class="progress-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>

            <!-- Problem display -->
            <div class="problem-container">
                <div id="problem" class="problem-text"></div>
            </div>

            <!-- Answer input -->
            <div class="answer-container">
                <input type="number" id="answer-input" placeholder="Your answer..." autofocus>
                <button id="submit-btn" class="submit-button">Check Answer! ✨</button>
            </div>

            <!-- Feedback area -->
            <div id="feedback" class="feedback"></div>

            <!-- Achievement display -->
            <div id="achievement" class="achievement-popup"></div>
        </div>
    </div>

    <!-- Minigame Screen -->
    <div id="minigame-screen" class="screen">
        <div class="minigame-container">
            <div class="minigame-header">
                <h2 class="minigame-title">🦊 <span id="player-name-battle">Math Battle</span>! 🧙‍♀️</h2>
                <div class="minigame-stats">
                    <div class="fox-health">
                        <span class="health-label">Fox Health:</span>
                        <div class="health-bar">
                            <div id="fox-health-fill" class="health-fill"></div>
                        </div>
                    </div>
                    <div class="spells-remaining">
                        <div id="spell-icons">⚡⚡⚡⚡⚡</div>
                    </div>
                </div>
            </div>

            <div class="battle-arena">
                <!-- Fox Character (can move up/down) -->
                <div id="fox-character" class="character fox">
                    <div class="character-sprite">🦊</div>
                    <div class="character-name" id="player-name-character">Player</div>
                </div>

                <!-- Battle Field with flying answers -->
                <div id="battle-field" class="battle-field">
                    <!-- Math spell projectiles and flying answers appear here -->
                </div>

                <!-- Witch Character -->
                <div id="witch-character" class="character witch">
                    <div class="character-sprite">🧙‍♀️</div>
                    <div class="character-name">Math Witch</div>
                </div>
            </div>

            <!-- Answer Input for Minigame -->
            <div class="minigame-input">
                <!-- Regular input spell -->
                <div id="input-spell-mode" class="spell-mode">
                    <input type="number" id="minigame-answer" placeholder="Answer..." autofocus>
                    <button id="minigame-submit" class="minigame-submit-button">Defend! ⚔️</button>
                    <div id="current-spell" class="current-spell-display">Incoming spell: 7 + 3 = ?</div>
                </div>

                <!-- Multiple choice spell -->
                <div id="choice-spell-mode" class="spell-mode hidden">
                    <div class="choice-spell-equation" id="choice-equation">5 × 4 = ?</div>
                    <div class="choice-instructions">Use ↑↓ arrow keys to move the fox vertically!<br/>Position yourself to catch the correct answer!</div>
                </div>
            </div>

            <!-- Minigame Feedback -->
            <div id="minigame-feedback" class="minigame-feedback"></div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="results-screen" class="screen">
        <div class="container">
            <h2 class="results-title">🎉 Great Job! 🎉</h2>
            <div class="results-stats">
                <div class="stat">
                    <span class="stat-label">Final Score:</span>
                    <span id="final-score" class="stat-value">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Best Streak:</span>
                    <span id="best-streak" class="stat-value">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Problems Solved:</span>
                    <span id="problems-solved" class="stat-value">0</span>
                </div>
            </div>
            <div class="results-actions">
                <button id="play-again-btn" class="action-button">Play Again! 🎮</button>
                <button id="change-level-btn" class="action-button">Change Level 📊</button>
                <button id="continue-quest-btn" class="action-button">Continue Quest! ⚔️</button>
            </div>
        </div>
    </div>

    <!-- Lessons Screen -->
    <div id="lessons-screen" class="screen">
        <div class="container">
            <h1 class="title">📚 Interactive Lessons</h1>
            <div class="mascot">🦊</div>
            <p class="subtitle">Learn new math strategies step by step!</p>
            
            <div class="lessons-grid">
                <button class="lesson-card" data-lesson="multiplication">
                    <div class="lesson-icon">✖️</div>
                    <h3>Multiplication Tricks</h3>
                    <p>Learn patterns and shortcuts for times tables</p>
                    <div class="lesson-level">Beginner → Intermediate</div>
                </button>
                
                <button class="lesson-card" data-lesson="division">
                    <div class="lesson-icon">➗</div>
                    <h3>Division Strategies</h3>
                    <p>Master division with visual methods</p>
                    <div class="lesson-level">Intermediate → Advanced</div>
                </button>
                
                <button class="lesson-card" data-lesson="two-digit">
                    <div class="lesson-icon">🔢</div>
                    <h3>Two-Digit Operations</h3>
                    <p>Addition and subtraction with carrying</p>
                    <div class="lesson-level">Beginner → Intermediate</div>
                </button>
            </div>
            
            <button id="back-to-menu-btn" class="action-button">← Back to Menu</button>
        </div>
    </div>

    <!-- Lesson Content Screen -->
    <div id="lesson-content-screen" class="screen">
        <div class="container">
            <div class="lesson-header">
                <button id="back-to-lessons-btn" class="back-btn">← Back to Lessons</button>
                <h1 id="lesson-title" class="lesson-title"></h1>
                <div class="lesson-progress">
                    <span id="lesson-step-indicator">Step 1 of 5</span>
                </div>
            </div>
            
            <div class="lesson-content">
                <div id="lesson-step-content" class="lesson-step">
                    <!-- Dynamic lesson content will be inserted here -->
                </div>
                
                <div class="lesson-navigation">
                    <button id="prev-step-btn" class="nav-btn" disabled>← Previous</button>
                    <button id="next-step-btn" class="nav-btn">Next →</button>
                    <button id="complete-lesson-btn" class="nav-btn complete-btn" style="display: none;">Complete Lesson ✓</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Selection Screen -->
    <div id="character-selection-screen" class="screen">
        <div class="container">
            <div class="lesson-header">
                <button id="back-to-welcome-btn" class="back-btn">← Back to Main Menu</button>
                <h1 class="lesson-title">🦊 Choose Your Character</h1>
            </div>
            
            <div id="character-grid" class="character-grid">
                <!-- Characters will be populated dynamically -->
            </div>
            
            <div class="character-info">
                <p>Complete battles to unlock new animal companions!</p>
                <div class="unlock-progress">
                    <div class="tier-progress">
                        <span class="tier-label">🌱 Beginner Tier:</span>
                        <span id="beginner-progress">Beat Level 3 to unlock</span>
                    </div>
                    <div class="tier-progress">
                        <span class="tier-label">🌿 Intermediate Tier:</span>
                        <span id="intermediate-progress">Beat Level 3 to unlock</span>
                    </div>
                    <div class="tier-progress">
                        <span class="tier-label">🌳 Advanced Tier:</span>
                        <span id="advanced-progress">Beat Level 3 to unlock</span>
                    </div>
                    <div class="tier-progress special">
                        <span class="tier-label">✨ Special:</span>
                        <span id="witch-progress">Collect all 3 tiers to unlock the Witch!</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Character Unlock Choice Modal -->
    <div id="character-unlock-modal" class="modal-overlay">
        <div class="modal-content character-unlock-content">
            <h2 class="unlock-title">🎉 Character Unlocked!</h2>
            <p class="unlock-message">Choose your new companion from the <span id="unlock-tier-name"></span> tier:</p>
            
            <div id="character-choices" class="character-choices">
                <!-- Character choices will be populated dynamically -->
            </div>
            
            <div class="unlock-actions">
                <button id="confirm-character-choice" class="action-button" disabled>Choose This Character</button>
            </div>
        </div>
    </div>

    <!-- Exit Confirmation Modal -->
    <div id="exit-confirmation-modal" class="modal-overlay">
        <div class="modal-content exit-confirmation-content">
            <h2 class="exit-title">🚪 Exit Game?</h2>
            <p class="exit-message">Are you sure you want to exit? Your current progress in this level will be lost.</p>
            
            <div class="exit-actions">
                <button id="cancel-exit-btn" class="action-button secondary">Cancel</button>
                <button id="confirm-exit-btn" class="action-button">Exit to Menu</button>
            </div>
        </div>
    </div>

    <!-- Loading scripts -->
    <script src="src/js/math-engine.js"></script>
    <script src="src/js/storage.js"></script>
    <script src="src/js/animations.js"></script>
    <script src="src/js/lessons.js"></script>
    <script src="src/js/minigame.js"></script>
    <script src="src/js/ui.js"></script>
    <script src="src/js/game.js"></script>
</body>
</html>
